{% trans_default_domain 'FOSUserBundle' %}
<h5 class="center-align">
    <i class="material-icons large">account_circle</i><br>
    {{ app.user }}
</h5>
<ul class="collapsible">
    {% if app.user.beneficiary %}
        {% set member = app.user.beneficiary.membership %}
        <li>
            <div class="collapsible-header"><i class="material-icons">edit</i>Mes informations</div>
            <div class="collapsible-body">
                {{ form_start(form, { 'action': path('beneficiary_edit', { 'id': app.user.beneficiary.id })}) }}
                {% include "beneficiary/_partial/beneficiary_form.html.twig" with { form: form } %}
                <div>
                    <button type="submit"
                            class="btn-large waves-effect waves-light btn">{{ 'profile.edit.submit'|trans }}</button>
                </div>
                {{ form_end(form) }}
            </div>
        </li>
        <li>
            <div class="collapsible-header"><i class="material-icons">build</i>Actions</div>
            <div class="collapsible-body">
                {% include "member/_partial/frozen.html.twig" with { member: member  } %}
            </div>
        </li>
        <li>
            <div class="collapsible-header"><i class="material-icons">credit_card</i>Badges</div>
            <div class="collapsible-body">
                {% for beneficiary in member.beneficiaries %}
                    {% if beneficiary.getEnabledSwipeCards | length %}
                        {% set card = beneficiary.getEnabledSwipeCards.first %}
                        {{ beneficiary.firstname }} : <img
                            src="{{ absolute_url(path('swipe_br',{"code": card.code | vigenere_encode})) }}"
                            alt="barecode">
                    {% endif %}
                {% endfor %}
            </div>
        </li>
    {% endif %}
    {% if app.user.clients | length %}
        <li>
            <div class="collapsible-header"><i class="material-icons">extension</i>Services</div>
            <div class="collapsible-body">
                <table>
                    <thead>
                    <tr>
                        <th></th>
                        <th>Service</th>
                        <th>Description</th>
                        <th>Actions</th>
                    </tr>
                    </thead>
                    <tbody>
                    {% for client in app.user.clients %}
                        <tr>
                            <td>
                                {% if client.service.logo %}
                                    <img src="{{ asset(vich_uploader_asset(client.service, 'logoFile')) | imagine_filter('service_logo') }}"
                                         alt="{{ client.service.name }}"
                                         class="circle responsive-img"
                                         style="background: white">
                                {% endif %}
                            </td>
                            <td>
                                <a href="{{ client.service.url }}" class="">{{ client.service.name }}</a>
                            </td>
                            <td>
                                {{ client.service.description }}
                            </td>
                            <td>
                                <a href="{{ path('user_client_remove',{'username':app.user.username,'client_id':client.id}) }}"
                                   class="btn-floating red left"><i class="material-icons">close</i></a>
                            </td>
                        </tr>
                    {% endfor %}
                    </tbody>
                </table>

            </div>
        </li>
    {% endif %}
</ul>


{# notes#}